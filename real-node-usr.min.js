"use strict";
// ==UserScript==
// @name			real-node
// @namespace		http://tampermonkey.net/
// @version			2024-12-14
// @description		Try to take over the world after watching the end of this script!
// @author			FANGZHANG34
// @match			https://*/*
// @grant			none
// ==/UserScript==
var RealWorld,RealNode,RealGroup,RealTarget,RealStory,RealPromise,RealElement,RealCanvas,RealLoader,RealSelect,RealComtag,RealSVG,RealDivList,RealImgList,RealDivQueue,createRealDivSelect,createRealDivSearch,createRealDivSeries;({RealWorld,RealNode,RealGroup,RealTarget,RealStory,RealPromise,RealElement,RealCanvas,RealLoader,RealSelect,RealComtag,RealSVG,RealDivList,RealImgList,RealDivQueue,createRealDivSelect,createRealDivSearch,createRealDivSeries}=(()=>{function prevent(e){return e}let l=globalThis.Element??prevent,i=globalThis.performance??Date,n=[],B=i.now(),p=Object.create(null),o=l!==prevent,a={writable:!1,enumerable:!1},u=console.log.bind(console),c=function*tryYieldKey(e,t,r){try{for(var s of e)yield s?.[t]??s}catch(e){console.error(e)}};var e,r,h=!1,s=globalThis.setInterval??prevent,d=globalThis.clearInterval??prevent;try{r=require,e=module.exports,h=!0}catch{e={},r=r=>new Promise(async t=>{try{var e=await import(String(r));t("default"in e?e.default:e)}catch(e){t(e),console.log("\n\r\t"+String(e)+e?.stack)}})}let f=r("fs");RealWorld.onload=o?new Promise(e=>addEventListener("load",function tempListener(){e(),removeEventListener("load",tempListener)})):h?Promise.resolve():new Promise(async t=>{if(s===prevent){let{setTimeout:i,clearTimeout:e}=globalThis.setTimeout?globalThis:await r("os");class Interval{constructor(e,t,...r){this._=i(this.transform(e,t,...r),t,...r)}transform(e,t,...r){let s=()=>{this._=i(s,t,...r),e.apply(null,r)};return s}clear(){e(this._)}}s=function(){return Reflect.construct(Interval,arguments)},d=e=>e.clear(),Reflect.defineProperty(R.eventLoop,"_id",{value:s(RealWorld.prototype._mainFn.bind(R.eventLoop),R.eventLoop.timeSep)}),t()}}),RealWorld.createInterval=function(e,t){return(e=new RealWorld(e)).intervalFn=t,e},RealWorld.getPromiseState=(()=>{let t=Symbol(),r=e=>+(t!==e),s=()=>-1;return function getPromiseState(e){return Promise.race([e,t]).then(r,s)}})(),RealWorld.onceIf=async(t,e)=>{if("function"!=typeof t)throw new TypeError('"ifFn" must be Function !');let r=new RealWorld(e);await new Promise(e=>(r.ifFn=t,r.soFn=e)),d(r._id)},RealWorld.cb2promise=function({thisArg:s,useFn:i,callback:t=function thisResolve(...e){this.resolve(e)}}=p,...o){if("function"!=typeof(i="function"!=typeof i?s?.[i]:i))throw new Error('=> Wrong:\n\t"thisArg" is not Object\n or\n\t"useFn" not in "thisArg" !');return new Promise(e=>{let r={callback:t,resolve:e};try{i.call(s,...o,(...e)=>r.callback(...e))}catch(t){try{i.call(s,(...e)=>r.callback(...e),...o)}catch(e){r.resolve([new Error("=> Neither head or tail of parameters is Callback !\n"+String(t?.stack??t)+"\n"+String(e?.stack??e))])}}}).catch(e=>console.error(e.stack))},RealWorld.prototype.destroy=function(){d(this._id),this._mainFn()},RealWorld.prototype.then=function(e){return"function"==typeof e&&this.fnList.unshift(e),this},RealWorld.prototype.getRealElement=function(){return new S({self:this.self,key:"innerHTML"},{id:this.self.id,initValue:this.self.innerHTML})},RealWorld.prototype.setTimeSep=function(e){return(Number.isFinite(e=Number(e))?e:10)!==this.timeSep&&(d(this._id),Reflect.defineProperty(this,"timeSep",{value:e}),Reflect.defineProperty(this,"_id",{value:s(this._mainFn.bind(this),this.timeSep)}))},RealWorld.prototype._mainFn=function(){if(!this.paused){try{this.intervalFn?.()}catch(e){this.intervalFn=console.error(e)}try{this.info=this.fnList.pop()?.call?.(this,this.info)}catch(e){console.error(e)}try{this.ifFn?.()&&(this.soFn?.(),this.ifFn=this.soFn=null)}catch(t){try{this.ifFn?.()}catch(e){t=e,this.ifFn=null,this.paused=!0}this.paused||(this.soFn=null),this.paused=!1,console.error(t)}}};var m,g=RealWorld;function RealWorld(e,...t){if(!new.target)return new RealWorld(e,...t);try{Number.isFinite(this.timeSep=Number(e))||(this.timeSep=10)}catch{this.timeSep=10}this._id=s(this._mainFn.bind(this),this.timeSep),this.fnList=t,this.info=m,this.self=o?document.createElement("div"):{},this.paused=!1,this.intervalFn=m,this.ifFn=m,this.soFn=m,Reflect.defineProperty(this,"_id",a),Reflect.defineProperty(this,"fnList",a),Reflect.defineProperty(this,"timeSep",a)}var t,v,y,R=class RealNode{static error(e){throw new Error(this.name+" : "+e)}static _sys=new Map;static t0=Date.now();static tryRealNode=!1;static now=Promise.resolve();static eventLoop=new g;static proto=class AntiNode{tryRealNode;childRNs=[];["get"];["set"];react;id;value};static search(e){return this._sys.get(e)}static is(e,t){return Object.is(e,t)||e===t}static justNow(e,t,...r){return RealNode.now.then(e.bind(t,...r))}static arrayToObject(){for(var e=Object.create(null),t=Array.from(arguments).flat(),r=t.length,s=0;s<r;s++)e[String(t[s])]=t[s];return e}static createExpression=(v=()=>!1,(e,...t)=>new RealNode({get:e,set:v},!0,...t));static check(e){for(var t of this._sys.entries())if(e===t[1])return e.id===t[0]}static createHidden=(t={display:!1},function(e){return new RealNode(Object.assign({},e,t))});static afterNow(t,e,r,...s){var i=new Promise(e=>this.eventLoop.then(()=>e(t.apply(r,s))));return e||(this.now=i.catch(prevent)),i}static protoCreate(e,...t){e=new RealNode({get:e});return e.proto.value=t,e}static createNumber=this.protoCreate.bind(null,function(e=0){if(!Array.isArray(this.proto.value))return+(this.proto.value instanceof RealNode?this.proto.value:this.proto).value;for(var t of this.proto.value)e+=+(t instanceof RealNode?t.value:t);return e});static copyObj=function copyObj(e){if(Object(e)!==e)return new.target?Object(e):e;var t,r=Array.isArray(e)?[]:Object.create(null);for(t of Object.keys(e))95!==t.charCodeAt(0)&&(r[t]=copyObj(e[t]));return r};static createString=this.protoCreate.bind(null,function(){if(Array.isArray(this.proto.value)){for(var e=this.proto.value.concat(),t=e.length;0<t--;)e[t]instanceof RealNode&&(e[t]=e[t].value);return e.join("")}return String((this.proto.value instanceof RealNode?this.proto.value:this.proto).value)});static async time(e,t){var r=i.now(),s={time:null,error:null,value:null};try{s.value=await("function"==typeof e?e():e)}catch(e){console.error(s.error=e)}if(s.time=i.now()-r,"function"==typeof t)try{t(s.time,s.error,s.value)}catch(e){console.error(e)}return s}static makeNumStr0oTail(e,t){var r,s;switch(typeof e){case"bigint":return e.toString();case"symbol":case"undefined":return"NaN"}try{e=+e}catch{return"NaN"}return Number.isFinite(e)?(t="number"!=typeof t?9:18<t?18:t<0?0:Math.floor(t),{0:r,1:s=""}=e.toString(8).split("."),BigInt("0o"+r).toString()+"_+0o"+s.slice(0,t).padEnd(t,"0")):"NaN"}static _react(e,t=!0,r=!0,s=!0){try{for(var i,o=this._getPositionsOfChildRN(e);o.length;){var a=o.pop().reverse();if(!a.length)return this.realSet(e.value,t,r,s);for(i=this.proto.value;1<a.length;)i=i[a.pop()];e.value!==i[a[0]]&&(i[a[0]]=e.value)}return t&&this.react?.(s),r&&this.notify(s),!0}catch(e){if(this instanceof RealNode)throw e;this.error('Please avoid using method "react" of typeof '+this?.name+" !\n"+e.message)}}protoReact(){}protoGet(){return this.proto.value}log(...e){console.log(this+":",...e)}done(){return RealNode.justNow(this.protoDone,this)}error(e){throw new Error(this+'\n"""\n'+String(e)+'\n"""')}protoSet(e){return e!==this.proto.value&&(this.proto.value=e,!0)}clearChildRNs(){for(;this.proto.childRNs.length;)this.proto.childRNs.pop().display=!1;return this}realReact(e=!0,t){var r=this.proto.react;return!!r&&(r.call(this),e&&this.notify(t),!0)}[Symbol.toPrimitive](e){try{return"number"===e?Number(this.value):"[object "+this.constructor.name+"]{ "+this.id.description+" }"}catch{return NaN}}async protoDone(){for(var e=0;e<this.notifyArray.length;)await Promise.allSettled(this.notifyArray[e++]);return e=this.notifyArray,this.notifyArray=[],e}notify(t,e,r){for(var s of this.relativeRNs)Promise.resolve(RealNode.search(s)).then(e=>!e||t&&this===e||e.realReact?.())}realSet(e,t,r,s){try{var i;return(this.proto.set.call(this,this.proto.tryRealNode&&(i=this._computePositionsOfRNs(e)).length?this._dealWithPositionsOfRNs(i,e):e)??!0)&&(t&&this.react?.(),r&&this.notify(s),!0)}catch(e){return console.error(e),e}}_getPositionsOfChildRN(e){for(var t,r=this.proto.childRNs,s=[],i=r.length;0<i--;)e===(t=r[i].info.values()).next().value&&s.push(...t);return s}protoNotify(r,s,i=0){s?i++:s=this,(s.notifyArray[i]||(s.notifyArray[i]=[])).push(new Promise(e=>{for(var t of this.relativeRNs)r&&t===this.id||!(t=RealNode.search(t))||(t.react?.(),t.notify(r,s,i));e()}))}relate(...e){for(var t=e[e.length-1],r=RealNode.search(t?.id??t);e.length;)"symbol"!=typeof(t=e.pop())&&(t instanceof RealNode?t=t.id:this.error('=> "relativeRNs['+e.length+']" is not legal id !')),RealNode.search(t)&&!this.relativeRNs.includes(t)&&this.relativeRNs.push(t);return r}unrelate(...e){if(!e.length)return!1;var t=this.relativeRNs.concat(),r=e.length;for(this.relativeRNs.splice(0);0<r--;)"symbol"!=typeof e[r]&&(e[r]=e[r]?.id);for(r=t.length;0<r--;)e.includes(t[r])||this.relativeRNs.push(t[r]);return t.length!==this.relativeRNs.length}_computePositionsOfRNs(e,t=2,r=[],s=0){var i,o,a=[];if(e instanceof RealNode)a.push((r.unshift(e),r));else if(s<t&&Object(e)===e)for(i=(o=Reflect.ownKeys(e)).length;0<i--;)a=a.concat(this._computePositionsOfRNs(e[o[i]],t,[...r,o[i]],s+1));return a}_dealWithPositionsOfRNs(e,t){var r,s,i,o=this.clearChildRNs().proto.childRNs,a=[];for(e=e.concat();e.length;){var n=e.pop(),l=n[0],n=n.slice(1);if(n.length){for(r=t,s=0,i=n.length-1;s<i;s++)r=r[key];r[n[s]]=l.value}else t=l.value;(s=a.indexOf(l))<0?(a.push(l),o.push(l.relate(new RealNode({info:[l,n],react:this.constructor._react.bind(this,l)})))):o[s].info.push(n)}return t}get id(){return this.proto.id}get childRNs(){return this.proto.childRNs}get value(){return this.get()}set value(e){this.realSet(e,!0,!0)}get set(){return this.realSet}set set(e){this.proto.set="function"==typeof e?e:this.protoSet}get get(){return this.proto.get}set get(e){this.proto.get="function"==typeof e?e:this.protoGet}get react(){return this.proto.react}set react(e){this.proto.react="function"==typeof e?e:e?this.protoReact:null}get display(){return RealNode._sys.has(this.id)}set display(e){e?RealNode._sys.set(this.id,this):RealNode._sys.delete(this.id)}get tryRealNode(){return this.proto.tryRealNode}set tryRealNode(e){e=(this.proto.tryRealNode=Boolean(e))?"appear":"disappear";for(var t=this.proto.childRNs.length;0<t--;)this.proto.childRNs[e]()}relativeRNs=[];notifyArray=[];constructor(e,t=RealNode.tryRealNode,...r){e=Object(e),this.proto=new this.constructor.proto,this.proto.id=Symbol(String(e.id??e.info?.id??"")),Reflect.defineProperty(this,"notifyArray",{enumerable:!1}),Reflect.defineProperty(this,"proto",a),this.display=e.display??!0,this.info=e.info,this.get=e.get,this.set=e.set,this.react=e.react,this.relate(...r),this.proto.value=e.initValue,this.tryRealNode=t,"value"in e&&(this.value=e.value)}},b=class RealGroup extends R{static tempProxy=class AntiGroup extends Function{apply(){return this.self}ownKeys(){return Reflect.ownKeys(this)}has(e,t){return Reflect.has(this,t)}construct(){return this.realGroup.getByFilter()}isExtensible(){return Reflect.isExtensible(this)}["get"](e,t){return this.realGroup.get(t)}preventExtensions(){return Reflect.preventExtensions(this)}deleteProperty(e,t){return Reflect.deleteProperty(this.self,t)}setPrototypeOf(e,t){return Reflect.setPrototypeOf(this,t)}["set"](e,t,r){return this.realGroup.set(Object.create(null,{[t]:{value:r}}))}defineProperty(e,t,r){return Reflect.defineProperty(this.self,t,r)}constructor(e,t){super(""),this.self=e,this.realGroup=t}};static groupMap=new Map;static _=()=>!0;static createDeepGroup=function createDeepGroup(e,t="",r,s){if(Object(e)!==e)return s?r?R.createHidden({id:t,initValue:e}):e:new RealGroup;var i=Reflect.getPrototypeOf(e);if(i&&i!==Object.prototype)return s?r?R.createHidden({id:t,initValue:e}):e:new RealGroup({self:e});for(var o=Object.create(null),a=Reflect.ownKeys(e),n=a.length,l=0;l<n;l++)o[a[l]]=createDeepGroup(e[a[l]],a[l],r,!0);return new RealGroup({self:o})};static getObjByStructure=(()=>{let a=(e,t)=>{var r,s,i,o;switch(t){case"boolean":return Boolean(e);case"null":case"undefined":return null;case"bigint":try{return BigInt(e)}catch{return 0n}case"number":try{return Number(e)}catch{return NaN}case"string":try{return String(e)}catch{return"Symbol(unknown)"}case"array":switch(typeof e){default:return[];case"string":return e.split("");case"object":if(null===e)return[];if(Array.isArray(e))return e.concat();for(i=[],s=Object.keys(e),r=0;;){1;{if(!(Number.isInteger(o=+s[r++])&&-1<o))return i;try{i[o]=e[o]}catch(e){console.error(e)}}}}default:if(Object(t)!==t)return e}for(e=Object(e),i=Object.create(null),r=(s=Object.keys(t)).length;0<r--;)try{t[o=s[r]];try{i[o]=a(e[o],t[o])}catch(e){i[o]=a(null,t[o]),console.error(e)}}catch(e){i[o]=null,console.error(e)}return i};return a})();keys(e){return e?Reflect.ownKeys(this.proxy()):Object.keys(this.proxy())}realSet(e,t,r){try{return this.protoSet(e)&&(t&&this.notify(r),!0)}catch(e){return console.error(e),e}}addSetterListener(e,t){var r;t&&("function"!=typeof t&&this.error('"listener" must be function !'),e=e??RealGroup._,Array.isArray(r=this.listenerMap.get(e))||this.listenerMap.set(e,r=[]),r.push(t))}protoReact(i=n){Array.isArray(i)||this.error('"keyArray" must be Array !'),this.listenerMap.forEach((t,r)=>{try{if("function"==typeof r?r(i):-1!==i.indexOf(r))for(var e=t.length,s=0;s<e;s++)try{t[s]()}catch(e){this.log("Wrong with ",t[s])}}catch(e){this.log("Wrong with ",r)}})}tryRealNodeSetter(){for(var e=this.proxy(),t=Reflect.ownKeys(e),r=t.length;0<r--;)Reflect.has(Reflect.getOwnPropertyDescriptor(e,t[r]),"get")||e[t[r]]instanceof R||(e[t[r]]=R.createHidden({initValue:e[t[r]]}));return this}getByFilter(e){for(var t=this.proxy(),r=Reflect.ownKeys(t),s="function"!=typeof e,i=Object.create(null),o=r.length;0<o--;)(s||e(r[o]))&&Reflect.set(i,r[o],t[r[o]]instanceof R?t[r[o]].value:t[r[o]]);return i}protoSet(e){if(Object(e)!==e)return!1;var t,r=this.proxy(),s=[];for(t of Reflect.ownKeys(Object(e)))e[t]instanceof R?(r[t]=e[t],s.push(t)):r[t]instanceof R?r[t].set(e[t],!0,!0,!0)&&s.push(t):e[t]!==r[t]&&(r[t]=e[t],s.push(t));if(this.listenerMap.get(RealGroup._).forEach(e=>e()),s.length)try{this.react?.(s)}catch(e){this.log(e?.stack??e)}else for(var i=this.listenerMap.get(RealGroup._),o=i.length,a=0;a<o;a++)try{i[a]()}catch(e){this.log("Wrong with ",i[a])}return Boolean(s.length)}protoGet(e){if(!arguments.length)return this.getByFilter();if(Object(e)!==e)return(s=this.proxy()[e])instanceof R?s.value:s;for(var t=this.proxy(),r=Reflect.ownKeys(Object(e)),s=Object.create(null),i=r.length;0<i--;)Reflect.set(s,r[i],t[r[i]]instanceof R?t[r[i]].value:t[r[i]]);return s}get proxy(){return this.proto.value}get set(){return this.realSet}set set(e){}get get(){return this.protoGet}set get(e){}get react(){return this.protoReact}set react(e){}get tryRealNode(){return!1}set tryRealNode(e){e&&this.log("I can not try realNode !")}listenerMap=new Map([[RealGroup._,[]]]);constructor({id:e,info:t,self:r=Object.create(null)}=p){var s;if((s=RealGroup.groupMap.get(r))instanceof RealGroup)return console.log('Please do not new for "self":'+r+" again !"),s;super({id:e,info:t}),Object(r)!==r&&this.error('"self" not typeof object !'),Reflect.defineProperty(this,"listenerMap",a),s=new RealGroup.tempProxy(r,this),this.proto.value=new Proxy(s,s),RealGroup.groupMap.set(r,this)}},w=class RealTarget extends R{static proto=class AntiTarget extends R.proto{self;isElement;transform};static searchByObj(e){var t=[];if(Object(e)===e)for(var r of RealTarget._sys.values())e===r.self&&t.push(r);return t}static _react(e,t=!0,r=!0,s=!0){try{for(var i,o=this._getPositionsOfChildRN(e);o.length;){var a=o.pop().reverse();if(!a.length)return this.realSet(e.value,t,r,s);for(i=this.proto.value;1<a.length;)i=i[a.pop()];e.value!==i[a[0]]&&(i[a[0]]=e.value)}return this.fix(),t&&this.react?.(s),r&&this.notify(s),!0}catch(e){if(this instanceof RealTarget)throw e;this.error('Please avoid using method "react" of typeof '+this?.name+" !\n"+e.message)}}protoTransform(e){return e}fix(){return this.self[this.key]=this.transform(this.proto.value),this}clearClassName(){return this.proto.isElement&&!(this.proto.self.className="")}addClassName(){return this.proto.isElement&&(this.proto.self.classList.add(...arguments),!0)}toggleClassName(e){return this.proto.isElement&&this.proto.self.classList.toggle(e)}removeClassName(){return this.proto.isElement&&(this.proto.self.classList.remove(...arguments),!0)}getIndexWithin(){for(var e=0,t=this.proto.self;t=t.previousElementSibling;)e++;return e}realSet(e,t,r,s){try{var i;return(this.proto.set.call(this,this.tryRealNode&&(i=this._computePositionsOfRNs(e)).length?this._dealWithPositionsOfRNs(i,e):e)??!0)&&(this.fix(),t&&this.react?.(),r&&this.notify(s),!0)}catch(e){return console.error(e),e}}applyCSS(e,t){this.proto.self instanceof l||this.error("I am not RealElement !");var r=e;if("string"!=typeof e){for(;(r=r?.parentElement)&&r!==this.proto.self;);r?e=" #"+(e.id||(e.id=S.getRandomId())):this.error('"selfSelector" must be String or my descendant !')}var s=this.proto.self.id||(this.proto.self.id=S.getRandomId());return!!(t="string"==typeof t?S.myStyle.get(t):Object(t))&&(S.addCSSRules("#"+s+(/^[A-Za-z]/.test(e)?" ":"")+e,t),S.addId(s,!1),!0)}clone(e,t,r){var s={self:this.proto.self instanceof l?this.proto.self.cloneNode():Object.assign(Object.create(Reflect.getPrototypeOf(this.proto.self)),this.proto.self),key:this.key,transform:this.transform},s=new RealTarget(s,{get:this.proto.get,set:this.proto.set,react:this.proto.react,id:this.id.description+"-clone",info:this.info,initValue:e?this.proto.value:void 0});return Reflect.setPrototypeOf(s,Reflect.getPrototypeOf(this)),null==r&&(s.relativeRNs=r?this.relativeRNs:this.relativeRNs.concat()),t?s.fix():s}get isElement(){return this.proto.isElement}get transform(){return this.proto.transform}set transform(e){this.proto.transform="function"==typeof e?e:this.protoTransform}get self(){return this.proto.self}set self(e){Object(e)===e?this.proto.isElement=(this.proto.self=e)instanceof l:this.error('=> "self" must be Object !')}constructor({self:e,key:t,transform:r},s,i,...o){super(s,i),this.proto,this.self=e,this.key=t,this.transform=r,i&&this.realSet(s.initValue),this.relate(...o),this.addClassName(this.constructor.name)}},S=class RealElement extends w{get self(){return this.proto.self}set self(e){Object(e)===e?this.proto.isElement=(this.proto.self=e)instanceof l:this.error('=> "self" must be Element !')}static idSet=new Set;static findId(e){return this.idSet.has(e)}static deleteId(e){return"string"!=typeof e&&console.error('=> Please use String "id" !'),this.idSet.delete(e)}static getRandomId(){for(var e;this.idSet.has(e="C3"+Math.floor(1e14*Math.random()).toString(36)););return e}static addId(e,t=!0){e&&("string"!=typeof e?this.error('=> Please use String "id" !'):this.idSet.has(e)?t&&this.error('=> Please use another "id" !'):this.idSet.add(e))}static myStyle=new Map;static selectorEventListeners={};static keyboardController=(o&&addEventListener("keydown",e=>{if(!/^(TEXTAREA)|(SELECT)|(INPUT)$/.test(document.activeElement?.tagName)){var t,r,s=document.querySelector(".onkeyboardControl")??document.querySelector(".keyboardController");if(s){switch(e.key){case RealElement.keyboardController?.previous:t=-1;break;case RealElement.keyboardController?.next:t=1;break;case RealElement.keyboardController?.enter:(r=w.searchByObj(s)[0])instanceof k?r.proto.list.length?(s.classList.remove("onkeyboardControl"),(r=r.proto.list[0]).classList.add("onkeyboardControl")):(r=s).click():(r=s.querySelector(".keyboardController"))?(s.classList.remove("onkeyboardControl"),r.classList.add("onkeyboardControl")):(r=s).click();break;case RealElement.keyboardController?.back:for(r=s;(r=r.parentElement)&&!r.classList.contains("keyboardController"););(r?(s.classList.remove("onkeyboardControl"),r):r=s).classList.add("onkeyboardControl")}if(t++)if((r=s).classList.remove("onkeyboardControl"),t){for(;(r=r.nextElementSibling)&&"none"===getComputedStyle(r).display;);(r=r||s.parentElement.firstElementChild).classList.add("onkeyboardControl")}else{for(;(r=r.previousElementSibling)&&"none"===getComputedStyle(r).display;);(r=r||s.parentElement.lastElementChild).classList.add("onkeyboardControl")}r&&r.animate({opacity:[1,0,1]},{duration:500})}}}),{previous:"ArrowUp",next:"ArrowDown",enter:"ArrowRight",back:"ArrowLeft"});static makeElementByString=(()=>{let t=o?document.createElement("template"):{content:{}};function makeElementByString(e){return t.innerHTML=String(e),t.content.firstElementChild}return makeElementByString._clear=()=>(t.innerHTML="",t.content),makeElementByString})();static createImg(){return new RealElement({self:document.createElement("img"),key:"src"})}static createVideo(){return new RealElement({self:document.createElement("video"),key:"src"})}static createAudio(){return new RealElement({self:document.createElement("audio"),key:"src"})}static createDiv(e,t=""){return new RealElement({self:document.createElement("div"),key:"textContent"},{id:e,initValue:t})}static createTextarea(e){var t=document.createElement("textarea");return new RealElement({self:(t.placeholder=String(e),t),key:"value"})}static newXHTML(e,t,r){e=document.createElement(e);return Object.assign(Object.assign(e,t).style,r),e}static makeElement(e,t,r){return Object.assign(Object.assign(e instanceof l?e:document.createElement(e),t).style,r),e}static applyKeyboardController(){for(var e of arguments)e instanceof l?e.classList.add("keyboardController"):e?.self instanceof l&&e.self.classList.add("keyboardController")}static cancelKeyboardController(){for(var e of arguments)e instanceof l?e.classList.remove("keyboardController"):e?.self instanceof l&&e.self.classList.remove("keyboardController")}static newSVG(e,t,r){e=document.createElementNS("http://www.w3.org/2000/svg",e);try{Object.keys(t).includes("href")&&"href"in e&&(e.href.baseVal=t.href)}catch{}return Object.assign(Object.assign(e,t).style,r),e}static newElements(e,t,r){var s,t=t[Symbol.iterator]();if(r)if(s=new DocumentFragment,"svg"===e)for(var i of t)s.appendChild(document.createElementNS("http://www.w3.org/2000/svg",i instanceof l?i.tagName:i));else for(var o of t)s.appendChild(document.createElement(o instanceof l?o.tagName:o));else if(s=[],"svg"===e)for(var a of t)s.push(document.createElementNS("http://www.w3.org/2000/svg",a instanceof l?a.tagName:a));else for(var n of t)s.push(document.createElement(n instanceof l?n.tagName:n));return s}static newDocumentFragmentFromElements(e){var t,r=new DocumentFragment;for(t of e)try{r.appendChild(t)}catch(e){console.error(e)}return r}static addEventListenerBySelectors=(e,r,t)=>{let s=r.replace(r[0],r[0].toUpperCase());e&&"*"!==e?(RealElement.selectorEventListeners[r]||(RealElement.selectorEventListeners[r]=new Map,addEventListener(r,e=>{var t=i.now();RealElement.selectorEventListeners[r].forEach(function temp(e,t,r){try{if(Array.from(document.querySelectorAll(r)).includes(e.target))for(var s=0,i=t.length;s<i;)try{t[s++](e)}catch(e){console.error,alert(e?.stack??e)}}catch(e){console.error(e)}}.bind(null,e)),u(s+"-listeners completed\nin "+R.makeNumStr0oTail(i.now()-t)+" ms.")})),RealElement.selectorEventListeners[r].has(e)?RealElement.selectorEventListeners[r].get(e).push(t):RealElement.selectorEventListeners[r].set(e,[t])):addEventListener(r,t)};static addCSSRules=(()=>{if(!o){let e=()=>e;return e._css=g.onload,e}var r=g.onload.then(function(){var e=document.getElementsByTagName("head")[0].appendChild(document.createElement("style"));window.createPopup||e.appendChild(document.createTextNode("")),r=e.sheet});let n=/^\.([A-Za-z][A-Z0-9a-z]{0,})$/,l=/[A-Za-z]$/,c=/^[A-Za-z]/,h=e=>Object(e)===e?Object.keys(e):[];var s=globalThis.CSSStyleSheet.prototype.insertRule?(e,t)=>r.insertRule(e+"{\n"+t+"}",r.cssRules.length):(e,t)=>r.addRule(e,t,-1),d=(e,t)=>r instanceof Promise?r.then(()=>(d=s)(e,t)):(d=s)(e,t);function addCSSRules(t,r){try{if(Array.isArray(t)){let e=t.length;for(;0<e--;)"string"==typeof t[e]&&addCSSRules(t[e],r);return addCSSRules}"string"!=typeof t&&RealElement.error('"prefix" in addCSSRules must be String !');for(var e of h(r)){var s,i=r[e],o=[];for(s of h(i))o.push(s,":",String(i[s]),";\n");d(t+(l.test(t)&&c.test(e)?" ":"")+e+" ",o.join(""))}var a=n.exec(t)?.[1];a&&RealElement.myStyle.set(a,Object.assign({},RealElement.myStyle.get(a),r))}catch(e){console.error(e)}return addCSSRules}return addCSSRules._css=r,addCSSRules})();static defaultInit=(y=!1,()=>y?g.onload:g.onload=(y=!0,g.onload.then(()=>R.time(()=>{RealElement.addCSSRules("",{"*":{margin:"0",padding:"0",border:"0","-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none"},":root":{"--mapWidth":"1920px","--halfBlack":"rgba(0, 0, 0, 0.5)","--halfWhite":"rgba(225, 225, 225, 0.5)","--noColor":"rgba(0, 0, 0, 0)"},pre:{"text-align":"left","align-content":"left","vertical-align":"top","white-space":"pre-wrap","word-wrap":"break-word"},html:{cursor:"default","background-color":"black",color:"white"},body:{transform:"rotate(0)","transform-origin":"50vmin 50vmin",overflow:"visible scroll"},"body>*":{position:"absolute"},hr:{border:"1px solid white,"},"::-webkit-scrollbar":{display:"none"}})(".coverBody",{"":{width:"100vmax",height:"56.25vmax"}})(".noDisplay",{"":{display:"none"}})(".disappear",{"":{visibility:"hidden"}})(".listDown",{"":{"writing-mode":"horizontal-tb"},">*":{position:"relative",display:"block"}})(".listRight",{"":{"writing-mode":"vertical-lr"},">*":{position:"relative",display:"block"}})(".listDownListRight",{"":{"writing-mode":"horizontal-tb"},">*":{position:"relative",display:"block","writing-mode":"vertical-lr"},">*>*":{position:"relative",display:"block"}})(".listRightListDown",{"":{"writing-mode":"vertical-lr"},">*":{position:"relative",display:"block","writing-mode":"horizontal-tb"},">*>*":{position:"relative",display:"block"}})("div.listClose",{"":{"writing-mode":"horizontal-tb"},">*":{position:"absolute"},">:nth-child(1)":{"z-index":"1"},">:nth-child(2)":{"z-index":"2"},">:nth-child(3)":{"z-index":"3"},">:nth-child(4)":{"z-index":"4"},">:nth-child(5)":{"z-index":"5"},">:nth-child(6)":{"z-index":"6"},">:nth-child(7)":{"z-index":"7"},">:nth-child(8)":{"z-index":"8"},">:nth-child(9)":{"z-index":"9"},">:nth-child(10)":{"z-index":"10"},">:nth-child(11)":{"z-index":"11"},">:nth-child(12)":{"z-index":"12"},">:nth-child(13)":{"z-index":"13"},">:nth-child(14)":{"z-index":"14"},">:nth-child(15)":{"z-index":"15"}})("div.listFar",{"":{"writing-mode":"horizontal-tb"},">*":{position:"absolute"},">:nth-last-child(1)":{"z-index":"1"},">:nth-last-child(2)":{"z-index":"2"},">:nth-last-child(3)":{"z-index":"3"},">:nth-last-child(4)":{"z-index":"4"},">:nth-last-child(5)":{"z-index":"5"},">:nth-last-child(6)":{"z-index":"6"},">:nth-last-child(7)":{"z-index":"7"},">:nth-last-child(8)":{"z-index":"8"},">:nth-last-child(9)":{"z-index":"9"},">:nth-last-child(10)":{"z-index":"10"},">:nth-last-child(11)":{"z-index":"11"},">:nth-last-child(12)":{"z-index":"12"},">:nth-last-child(13)":{"z-index":"13"},">:nth-last-child(14)":{"z-index":"14"},">:nth-last-child(15)":{"z-index":"15"}})(".onhover",{":hover":{background:"linear-gradient(#fff,#000,#000,#fff)"}})(".onactive",{":active":{background:"linear-gradient(#000,#fff,#fff,#000)"}})(".childOnhover",{">:hover":{background:"linear-gradient(#fff,#000,#000,#fff)"}})(".childOnactive",{">:active":{background:"linear-gradient(#000,#fff,#fff,#000)"}})(".relativeSquare",{"":{width:"20vmin",height:"20vmin"}})(".fontTitle",{"":{"font-size":"20vmin"}})(".fontHead",{"":{"font-size":"10vmin"}})(".fontNormal",{"":{"font-size":"3vmin"}})(".scrollY",{"":{overflow:"hidden scroll"}})(".scrollX",{"":{overflow:"scroll hidden"}})(".scrollXY",{"":{overflow:"scroll"}})(".scrollNone",{"":{overflow:"hidden"}})(".centerCenter",{"":{"text-align":"justify","align-items":"center","align-content":"center","vertical-align":"baseline","justify-content":"center"}})(".autoFull",{"":{width:"100vmax",height:"100vmin"}})(".selfCenterCenter",{"":{left:"50%",top:"50%",transform:"translate(-50%,-50%)"}})._css.finally()},e=>u("Init defaultCSS\nin "+R.makeNumStr0oTail(e)+" ms.")))))};{let t=function(){if(!new.target)return new t;this.resolve=null,this.reject=null,this.promise=new Promise(function(e,t){this.resolve=e,this.reject=t}.bind(this))};var N=new class RealStory{newPage(){return new RealStory(this)}newPrivatePage(t){return new Promise(e=>e(t?.(this.newPage())))}then(e){return"function"==typeof e&&this.fnList.unshift(e),this}getNextPage(){var e;if(this.ofStory instanceof RealStory)return(e=this.ofStory.pages)[e.indexOf(this)+1]}getPreviousPage(){var e;if(this.ofStory instanceof RealStory)return(e=this.ofStory.pages)[e.indexOf(this)-1]}newPromiseObj(){let e=new t;return this.then(()=>e.promise),e}async launch(){for(var t=0,e=this;(e=e.ofStory)instanceof RealStory;)t++;for(t||(r=!0);this.pages.length||this.fnList.length;){for(;this.fnList.length;)try{this.info=await this.fnList.pop()?.(this.info)}catch(e){console.error("Depth of the fn : "+t+"\n"+String(e?.stack??e))}try{await this.pages.shift()?.launch?.()}catch(e){console.error("Depth of the page : "+t+"\n"+String(e?.stack??e))}}t||(r=!1)}get StoryPromise(){return t}get index(){return this.ofStory instanceof RealStory?this.ofStory.pages.indexOf(this):-1}ofStory;pages=[];fnList=[];info;constructor(e){(this.ofStory=e instanceof RealStory&&e)&&e.pages.push(this)}};let r=Reflect.getPrototypeOf(N).constructor=!1;g.onload.then(()=>Reflect.getPrototypeOf(N).constructor=s(()=>r||N.launch(),50))}var C,L,E,x,O,k,A,P,j,T,D,M=new class RealPromise{newOne(e){return new RealPromise(e)}catch(e){return this.self=Promise.resolve(this.self).catch(e),this}finally(e){return this.self=Promise.resolve(this.self).finally(e),this}_push(e){return this.list.push(e),e}_throw(e){throw this.list.push(e),e}then(e,t){return this.self=Promise.resolve(this.self).then(e,t).then(this._push,this._throw),this}async tryHandler(e,t){if("function"!=typeof e)throw new TypeError('"handler" must be Function !');try{await this.self}catch(e){console.error(this.length,e)}for(var r=this.length;0<r--;)try{try{return e(await this.list[r])}catch(e){(t??console.error)(e)}}catch(e){console.error(e)}}get require(){return RealPromise.require}static require=(()=>{let s={},i=/[^\/]+\/\.\.\//g;return h?function(e){return this instanceof RealPromise&&this._push(Promise.resolve(r(String(e))))}:o?function(e){var t,r;if(e=String(e).replaceAll("\\","/"),!(this instanceof RealPromise))return Promise.reject();for(;i.test(e);)e=e.replaceAll(i,"");return s[e]||(s[e]=(t=N.StoryPromise(),document.head.appendChild(((r=document.createElement("script")).onload=t.resolve,r.onerror=t.reject,r.src=e,r)),this._push(t.promise.finally(function onfinally(){this.remove()}.bind(r)))))}:function(){return Promise.reject(new Error("Mode error !"))}})();get length(){return this.list.length}list=[];constructor(e){Reflect.defineProperty(this,"list",a),Reflect.defineProperty(this,"_push",{value:this._push.bind(this),enumerable:!1,writable:!1}),Reflect.defineProperty(this,"_throw",{value:this._throw.bind(this),enumerable:!1,writable:!1}),this.self=Promise.resolve(e).then(this._push,this._throw)}}(g.onload.then(()=>e));return M.self.finally(()=>R.time(g.onload,e=>u("Set up\nin "+R.makeNumStr0oTail(e)+" ms."))),o?(C=class RealCanvas extends S{static proto=class AntiCanvas extends w.proto{temp=document.createElement("canvas").getContext("2d");backup=document.createElement("canvas").getContext("2d");img=new Image;isElement=!0;clearBeforeDraw=!0;ctx};static useCache=!0;static srcImageMap=new Map;static strN(e,t){return String(e).padStart(t,"0")}static preloadSrc(){for(var e=n.concat(...arguments),t=e.length;0<t--;)e[t]=RealCanvas.getImageBySrc(e[t]);return Promise.allSettled(e)}static getImageBySrc=e=>new Promise(function dealWithSrc(e,t,r){let s=RealCanvas.srcImageMap.get(e)??new Image;s.src?t(s):!e||"string"!=typeof e||RealCanvas.useCache&&RealCanvas.srcImageMap.has(e)?r():Object.assign(s,{onload:()=>(RealCanvas.srcImageMap.set(e,s),s.onload=s.onerror=t(s)),onerror:r,src:e})}.bind(null,e));static getRealGroupToClear=(()=>{class ConfigToClearShape{x=0;y=0;radiusX;radiusY;shape;relative}return function getRealGroupToClear(e,{initFn:t,fnBeforeClear:r,fnAfterClear:s}=p){if(!(e instanceof RealCanvas))throw new Error('=> "realCanvas" must be instanceof RealCanvas !');"function"==typeof s&&(s=s.bind(e)),"function"==typeof r&&(r=r.bind(e));let i=new ConfigToClearShape,o=new b({self:i});return o.addSetterListener(null,async()=>{await Promise.resolve(e.loaded).then(r),await e.clearShape(i,i.shape).then(s)}),e.loaded.finally(t),o}})();protoTransform(){}protoGet(){return this.loaded.then(()=>this.proto.value)}clearAsync(){return this.loaded=Promise.resolve(this.loaded).then(()=>this.clear())}fix(e=this.proto.temp.canvas){(this.proto.clearBeforeDraw?this.clear():this.proto.ctx).drawImage(e,0,0)}preloadSrc(){return this.loaded=Promise.resolve(this.loaded).then(prevent.bind(null,RealCanvas.preloadSrc.apply(null,arguments)))}clear(){return this.proto.ctx.clearRect(0,0,this.proto.self.width,this.proto.self.height),this.proto.ctx.closePath(),this.proto.ctx}clearTemp(){return this.proto.temp.clearRect(0,0,this.proto.self.width,this.proto.self.height),this.proto.temp.closePath(),this.proto.temp}testSrc(e){return this.loaded=Promise.resolve(this.loaded).then(()=>RealCanvas.getImageBySrc(e)).then(()=>!0,this.rejectSrc.bind(this,e))}rejectSrc(e,t){return e&&console.error(t instanceof Error?t:(RealCanvas.useCache&&t&&RealCanvas.srcImageMap.set(e),this+': Fail to load by src "'+e+'" !')),!1}protoSet(t){return this.loaded=Promise.resolve(this.loaded).then(()=>RealCanvas.getImageBySrc(t)).then(e=>(this.proto.img=e,this.proto.value=t,!0),this.rejectSrc.bind(this,t))}toBlob(){try{return g.cb2promise({thisArg:this.self,useFn:"toBlob"}).then(e=>e[0]instanceof Error?(console.error(e[0]),new Blob):e[0])}catch(e){return console.error(e),Promise.resolve(new Blob)}}resizeBySrc(e){return this.loaded=Promise.resolve(this.loaded).then(()=>RealCanvas.getImageBySrc(e)).then(e=>{this.self.width!==e.naturalWidth&&(this.width=e.naturalWidth),this.self.height!==e.naturalHeight&&(this.height=e.naturalHeight)})}realSet(e,t,r,s){var i;return this.loaded=Array.isArray(e)?this.multiDrawSrcArray({},...e).then(()=>{this.proto.value=e}):Promise.resolve(this.proto.set.call(this,this.proto.tryRealNode&&(i=this._computePositionsOfRNs(e)).length?this._dealWithPositionsOfRNs(i,e):e)??!0).then(e=>e&&(this.fix(this.img),t&&this.react?.(),r&&this.notify(s),!0)).catch(e=>(console.error(e),e))}multiDrawSrcArray({bgSrc:e,autoOpacity:t,resize:r},...s){this.preloadSrc(e,s);var i=-1,o=e??s[0]??!1;if(r&&o&&this.resizeBySrc(o),this.loaded=Promise.resolve(this.loaded).then(()=>this.clearTemp()),Array.isArray(e))for(o=e.length;o>++i;)this.temp=e[i];else e&&"string"==typeof e&&(this.temp=e);if(1<s.length&&t)for(i=s.length,o=0;0<i--;)this.tempOpacity=.625**i,this.temp=s[o++];else for(i=-1,o=s.length;o>++i;)this.temp=s[i];return this.loaded=Promise.resolve(this.loaded).then(()=>{this.fix(this.proto.temp.canvas)},e=>u(e?.stack??e))}applyMouseClear({radiusX:t,radiusY:r,relative:s}=p,i){let o=this.proto.self,e=this.proto.backup,a=getComputedStyle(o),n=()=>(e.canvas.width=o.width,e.canvas.height=o.height,e.drawImage(o,0,0)),l=e=>(c(),this.clearShape({x:e.offsetX*o.width/+a.width.slice(0,-2),y:e.offsetY*o.height/+a.height.slice(0,-2),radiusX:t,radiusY:r,relative:s},i)),c=()=>this.clear().drawImage(e.canvas,0,0);return o.addEventListener("mouseenter",n),o.addEventListener("mouseleave",c),o.addEventListener("mousemove",l),()=>(o.removeEventListener("mouseenter",n),o.removeEventListener("mouseleave",c),o.removeEventListener("mousemove",l))}clearShape({x:a=0,y:n=0,radiusX:l,radiusY:c,relative:h}=p,d){var e=!1;return"number"==typeof l?"number"!=typeof c&&(c=l):"number"==typeof c?l=c:e=!0,(e=e||!Number.isFinite(l+c))?Promise.reject(new Error('"radiusX": '+String(l)+' or "radiusY": '+String(c)+" must be legal number !")):("number"!=typeof a&&(a=0),"number"!=typeof n&&(n=0),(e=e||!Number.isFinite(a+n))?Promise.reject(new Error('"x": '+String(a)+' or "y": '+String(n)+" must be legal number !")):this.loaded=Promise.resolve(this.loaded).then(()=>{var e,t=this.proto.self,r=this.proto.temp,s=0;if(l=Math.abs(h?l*this.width/2:l),c=Math.abs(h?c*this.height/2:c),r.canvas.width=t.width,r.canvas.height=t.height,r.drawImage(t,0,0),"rect"!==d){a=Math.round(a),n=Math.round(n),l=Math.ceil(l);for(var i=(c=Math.ceil(c))**2,o=i/l**2;s++<l;)e=Math.floor(Math.sqrt(i-s**2*o))+1,r.clearRect(a-s,n-e,2*s,2*e)}else r.clearRect(Math.floor(a-l),Math.floor(n-c),Math.ceil(2*l),Math.ceil(2*c)),this.clear().drawImage(r.canvas,0,0);this.clear().drawImage(r.canvas,0,0)}).catch(e=>console.error(e)))}animate({prefix:r,suffix:s,startN:i=0,length:o,midLength:a,bgSrc:n,playMode:l=0,timeSep:c=100,sizeMode:h="std",resizeAfter:d=!0}=p){let u={width:this.width,height:this.height},e=[];var f=i+o+l;for(o*="1235"[l]||1,c/="1235"[l]||1;f-- >i;)e.push(r+RealCanvas.strN(f,a)+s);return this.preloadSrc(e),f=0,{loaded:this.loaded,finished:this.loaded.then(()=>{var e;let t=new g(c);switch("auto"===h&&(e=!0),l){default:for(;0<o--;)t.then(this.multiDrawSrcArray,this,{bgSrc:n,resize:e},r+RealCanvas.strN(i++,a)+s);case 1:for(;0<o--;)t.then(this.multiDrawSrcArray,this,{bgSrc:n,autoOpacity:!0,resize:e},(f=!f)||r+RealCanvas.strN(i++,a)+s,!1,r+RealCanvas.strN(i,a)+s);break;case 2:for(;0<o--;)t.then(this.multiDrawSrcArray,this,{bgSrc:n,autoOpacity:!0,resize:e},1===f?r+RealCanvas.strN(i+1,a)+s:2===f&&r+RealCanvas.strN(i,a)+s,!1,f<2?r+RealCanvas.strN(i,a)+s:r+RealCanvas.strN(i+1,a)+s),3==++f&&(i++,f%=3);break;case 3:for(;0<o--;)t.then(this.multiDrawSrcArray,this,{bgSrc:n,autoOpacity:!0,resize:e},1===f?r+RealCanvas.strN(i+1,a)+s:4===f&&r+RealCanvas.strN(i,a)+s,!1,2===f?r+RealCanvas.strN(i+1,a)+s:3===f&&r+RealCanvas.strN(i,a)+s,!1,f<3?r+RealCanvas.strN(i,a)+s:2<f&&r+RealCanvas.strN(i+1,a)+s),5==++f&&(i++,f%=5)}return t.then(()=>(this.clearTemp(),d&&Object.assign(this,u),t.destroy()))})}}get ctx(){return this.proto.ctx}get img(){return this.proto.img}get imgW(){return this.proto.img.naturalWidth}get imgH(){return this.proto.img.naturalHeight}get width(){return this.proto.self.width}set width(e){this.proto.self.width=this.proto.temp.canvas.width=e??640}get height(){return this.proto.self.height}set height(e){this.proto.self.height=this.proto.temp.canvas.height=e??360}get self(){return this.proto.self}set self(e){e instanceof HTMLCanvasElement&&(this.proto.ctx=(this.proto.self=e).getContext("2d"))}get clearBeforeDraw(){return this.loaded.then(()=>this.proto.clearBeforeDraw)}set clearBeforeDraw(e){this.loaded=Promise.resolve(this.loaded).then(()=>this.proto.clearBeforeDraw=e)}get temp(){return this.proto.temp.canvas}set temp(e){return this.proto.set.call(this,e).then(()=>(this.proto.temp.drawImage(this.img,0,0),!0),this.rejectSrc.bind(this,e))}get opacity(){return this.loaded.then(()=>this.proto.ctx.globalAlpha)}set opacity(t){Array.isArray(t)||(t=[t]),this.loaded=Promise.resolve(this.loaded).then(()=>t[0]).then(e=>{this.proto.ctx.globalAlpha=e*(t[1]??1)})}set tempOpacity(t){Array.isArray(t)||(t=[t]),this.loaded=Promise.resolve(this.loaded).then(()=>t[0]).then(e=>{this.proto.temp.globalAlpha=e*(t[1]??1)})}loaded=R.now;constructor(e,t,r,s,...i){var o=e,a=o instanceof l?(e=o.id,o):"string"==typeof o?document.getElementById(o):(e="",!1);a&&a instanceof HTMLCanvasElement&&R.error('=> "id" exists but not within an HTMLCanvasElement !'),S.addId(e,!a),o={id:e},super({self:a||S.newXHTML("canvas",o)},o,s,...i),this.proto,this.width=t,this.height=r,this.proto.ctx=this.proto.self.getContext("2d")}},L=class RealLoader extends S{static proto=class AntiLoader extends w.proto{onerror;onloadend};static fs=(()=>{let t={method:"HEAD"},r=e=>[,e],s=e=>[e];class DocumentFs{get stat(){return DocumentFs.stat}get readdir(){return DocumentFs.readdir}}return DocumentFs.fetch=(()=>{let r=e=>e.status<300?e:RealLoader.error("Failed request !");return o&&"file:"===document.location.protocol?(e,t)=>fetch(e,((t=Object.assign({},t)).mode="no-cors",t)).then(r):(e,t)=>fetch(e,Object(t)).then(r)})(),DocumentFs.stat=h?async e=>g.cb2promise({thisArg:await f,useFn:"stat"},e):e=>DocumentFs.fetch(e,t).then(r,s),DocumentFs.readdir=h?async e=>g.cb2promise({thisArg:await f,useFn:"readdir"},e):async(e,...t)=>{try{var r,s=t.length,i=s;for(/\/$/.test(e)||(e+="/");0<i--;)if(Array.isArray(t[i]))for(r=t[i].length;0<r--;)t[i][r]=String(t[i][r]);else{var o=String(t[i]);if("\\"===o[0])switch(o[1]){case"w":t[i]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";break;case"d":t[i]="0123456789"}else t[i]=[o]}for(var a=[],n=[],l=[],c=Array(s).fill(0);!("-1"in c);){for(r="",i=0;i<s;i++)r+=t[i][c[i]];for(n.push(r),r=e+r,a.push(DocumentFs.stat(r)),c[(i=s)-1]++;0<i--;)t[i].length>c[i]||(c[i]=0,c[i-1]++)}for(var h=await Promise.all(a),d=h.length,i=0;i<d;i++)h[i][0]??u(l.push(n[i]),n[i]);return[null,l]}catch(e){return[e,[]]}},new DocumentFs})();static _configDescriptor=(o&&addEventListener("click",async e=>{if(e.target.classList.contains("RealLoader"))for(var t of w.searchByObj(e.target))if(t instanceof RealLoader){try{var r=(await RealLoader.load(t))[0];r?t.onerror?.(r):t.onloadend?.()}catch(e){console.error(e)}t.notify(!0),t.react?.();break}}),{writable:!1,enumerable:!1,configurable:!1});static getArrayBufferFrom(e){return Promise.resolve(e instanceof ArrayBuffer?e:ArrayBuffer.isView(e)?e.buffer:(e instanceof Blob?e:new Blob(Array.isArray(e)?e.join(""):String(e))).arrayBuffer())}static load=h?async t=>{try{if("upload"===t.type){let e=t.temp.files;return t.temp.click(),await g.onceIf(()=>e!==t.temp.files,10),[]}let r=await f;var e=await t.dataGetter(),{1:s="file",2:i=""}=/(.+)(\..+)/.exec(t.temp.download)||n,o=await g.cb2promise({thisArg:r,useFn:"stat"},"./"+t.temp.download);if(o||this.error("Unknown Error !"),o[0])return RealLoader.getArrayBufferFrom(e).then(e=>g.cb2promise({thisArg:r,useFn:"writeFile"},"./"+t.temp.download,Buffer.from(e)));for(var a=1;;a++){1;{let t="./"+s+" - "+a+i;if((await g.cb2promise({thisArg:r,useFn:"stat"},t))[0])return RealLoader.getArrayBufferFrom(e).then(e=>g.cb2promise({thisArg:r,useFn:"writeFile"},t,Buffer.from(e)))}}}catch(e){return[e]}}:(()=>{let s=e=>new Blob(e);return async t=>{try{if("upload"===t.type){let e=t.temp.files;t.temp.click(),await g.onceIf(()=>e!==t.temp.files,10)}else{var e=await t.dataGetter(),r=URL.createObjectURL(await("string"==typeof e?new Blob([e]):e instanceof Blob?e:RealLoader.getArrayBufferFrom(e).then(s)));t.temp.href=r,t.temp.click(),URL.revokeObjectURL(r)}return[]}catch(e){return[e]}}})();load(){return RealLoader.load(this)}protoSet(e){return this.self[this.key]=String(e),!1}get files(){return"upload"===this.type?this.temp.files:this.error("I'm an downloader without files !")}get onerror(){return this.proto.onerror}set onerror(e){this.proto.onerror="function"==typeof e?e:null}get onloadend(){return this.proto.onloadend}set onloadend(e){this.proto.onloadend="function"==typeof e?e:null}get fileName(){return"upload"===this.type?this.error('Uploader bans "fileName" !'):this.temp.download}set fileName(e){"upload"===this.type&&this.error('Uploader bans "fileName" !'),"symbol"==typeof e&&this.error('"fileName" must be String but not Symbol !'),h&&!/^\.\//.test(e)&&(e="./"+e),this.temp.download=e}dataGetter;constructor(e,t,r,{innerHTML:s,onerror:i,onloadend:o}=p){super({self:document.createElement("div"),key:"innerHTML"}),this.proto,this.onerror=i,this.onloadend=o,this.dataGetter=r,this.value=s,e=Boolean(e),this.temp=document.createElement(e?"a":"input"),Reflect.defineProperty(this,"temp",RealLoader._configDescriptor),this.type=e?(this.fileName=t||"file","download"):(this.temp.type="file","upload"),Reflect.defineProperty(this,"type",RealLoader._configDescriptor)}},E=class RealSelect extends S{static proto=class AntiSelect extends w.proto{list=[]};static _react(e,t=!0,r=!0,s=!0){try{for(var i,o,a=this._getPositionsOfChildRN(e);a.length;){var n=a.pop().reverse(),l=e.value;if(!n.length)return this.realSet(l,t,r,s);for(i=this.proto.value;1<n.length;)i=i[n.pop()];if(l!==i[n[0]]&&(i[n[0]]=l),i===this.proto.value){o=0;for(var c of Object.keys(i)){if(c===n[0]){this.proto.list[o].value=String(l);break}o++}}}return t&&this.react?.(s),r&&this.notify(s),!0}catch(e){if(this instanceof RealSelect)throw e;this.error('Please avoid using method "react" of typeof '+this?.name+" !\n"+e.message)}}protoSet(e){return this.proto.value=Object.assign({},e),!0}fix(){return this.self[this.key]=this.protoTransform(this.proto.value),this.proto.list=Array.from(this.self.children),this}getValueIndexs(){for(var e=this.proto.list.length,t=[];0<e--;)this.proto.list[e].selected&&t.push(e);return t.reverse()}protoGet(){for(var e=[],t=this.proto.list,r=t.length,s=0;s<r;s++)t[s].selected&&e.push(t[s].value);return e}protoTransform(e,t=String(this.defaultKey),r=String(this.defaultValue)){this instanceof RealSelect&&!this.self.multiple&&(e=Object.assign({[t]:r},e));for(var s,i=[],o=Object.entries(e).sort((e,t)=>e[0].localeCompare(t[0])).sort((e,t)=>e[0]-t[0]).values();!(s=o.next()).done;)i.push(`<option value="${String(s.value[1])}" ${s.value[0]===t?"selected":""}>${s.value[0]}</option>`);return i.join("")}get list(){return this.proto.list}constructor(e,t,r,s,i,o,a){var n=e,n=n instanceof l?(e=n.id,n):"string"==typeof n?document.getElementById(n):(e="",!1);n&&(n instanceof HTMLSelectElement?Object.assign(n,{multiple:t,onchange:a}):R.error('=> "id" exists but not within an HTMLSelectElement !')),S.addId(e,!n),super({key:"innerHTML",self:n||S.newXHTML("select",{id:e,multiple:t,onchange:a})},{id:e,initValue:Object.assign({},r)},s),this.proto,this.defaultKey=i??"_",this.defaultValue=o??"",this.fix()}},x=class RealComtag extends S{static comtagClassMap=new Map;static defineComtagClass(e,t){var{optionList:t=[],tryRealNode:r,selfAssign:s,cssRuleObjObj:i,callback:o}=t||p;/^([A-Za-z]\w*)$/.test(e)||this.error('Illegal "className" !'),this.comtagClassMap.has(e)&&this.error('"className" repeated !'),t?.[Symbol.iterator]||this.error('"optionList" must be Array !'),this.addCSSRules("."+e,i),this.comtagClassMap.set(e,[t,r,s,"function"==typeof o?o:null])}static createByClassName(e,...t){Comtag;var r=this.comtagClassMap.get(e),s=(r||this.error('"className" not found !'),new RealComtag("",r[0],r[1],r[2]));return r[3]&&r[3].apply(s,t),s.addClassName(e),s}protoTransform(e){return S.newElements("",e,!0)}fix(){return this.self.innerHTML="",this.self.appendChild(this.transform(this.proto.value)),this}protoSet(e){if(!e?.[Symbol.iterator])throw new Error('=> "value" must be Array !');for(var t=Array(2),r=c(e,"tagName"),s=c(this.proto.value,"tagName");t[0]=s.next(),t[1]=r.next(),!t[0].done^t[1].done&&!t[0].done;)if(t[0].value.toLowerCase()!==t[1].value.toLowerCase())return this.proto.value=Array.from(e),!0;return!1}constructor(e,t,r,s){var i=e,i=i instanceof l?(e=i.id,i):"string"==typeof i?document.getElementById(i):(e="",!1);S.addId(e,!i),super({self:i||S.newXHTML("div",{id:e})},{id:e,initValue:t?.[Symbol.iterator]?Array.from(t):[]},r),Object.assign(this.fix().self,s)}},O=class RealSVG extends x{static comtagClassMap;static defineComtagClass;static createByClassName;static newImages(e,t){var r;if(t)for(var s of(r=t instanceof l?t:new DocumentFragment,e))try{r.appendChild(document.createElementNS("http://www.w3.org/2000/svg","image")).href.baseVal=String(s)}catch(e){console.error(e)}else for(var i of(r=[],e))try{var o=document.createElementNS("http://www.w3.org/2000/svg","image");r.push(o),o.href.baseVal=String(i)}catch(e){console.error(e)}return r}protoTransform(e){return S.newElements("svg",e,!0)}constructor(e,t,r,s){super(document.createElementNS("http://www.w3.org/2000/svg",e),t,!1,r),"function"==typeof s&&s.call(this,Array.from(this.proto.self.children))}},k=class RealDivList extends S{static proto=class AntiList extends w.proto{list=[];childrenList=[]};static divListClassMap=new Map;static createList(e=0,t,r,s){for(var i=[];0<e--;)i.push(document.createElement(t));return new RealDivList(r,!0,i,RealDivList.tryRealNode,s)}static _react(e,t=!0,r=!0,s=!0){try{for(var i,o=this._getPositionsOfChildRN(e);o.length;){var a=o.pop().reverse().concat(),n=e.value;if(!a.length)return this.realSet(n,t,r,s);for(i=this.proto.value;1<a.length;)i=i[a.pop()];n!==i[a[0]]&&(i[a[0]]=n),i===this.proto.value&&((a[1]=this.proto.list[a[0]]).innerHTML=""),n instanceof l?a[1].appendChild(n):this.tryHTML?a[1].innerHTML=n:a[1].textContent=n}return t&&this.react?.(s),r&&this.notify(s),!0}catch(e){if(this instanceof RealDivList)throw e;this.error('Please avoid using method "react" of typeof '+this?.name+" !\n"+e.message)}}static defineDivListClass(e,t){var{tryHTML:t,optionList:r=[],tryRealNode:s,selfAssign:i,cssRuleObjObj:o,callback:a}=t||p;/^([A-Za-z]\w*)$/.test(e)||this.error('Illegal "className" !'),this.divListClassMap.has(e)&&this.error('"className" repeated !'),r?.[Symbol.iterator]||this.error('"optionList" must be Array !'),this.addCSSRules("."+e,o),this.divListClassMap.set(e,[t,r,s,i,"function"==typeof a?a:null])}static createByClassName(e,...t){var r=this.divListClassMap.get(e),s=(r||this.error('"className" not found !'),new RealDivList("",r[0],r[1],r[2],r[3]));return r[4]&&r[4].apply(s,t),s.addClassName(e),s}protoGet(){return this.proto.list}protoSet(e){return this.proto.value=Array.from(e),!0}protoTransform(e){var t,r,s=[];try{var i=e[Symbol.iterator]()}catch{throw new Error('=> "value" must be Array !')}for(;!(t=i.next()).done;)s.push(r=document.createElement("div")),t.value instanceof l?r.appendChild(t.value):this.tryHTML?r.innerHTML=String(t.value):r.textContent=String(t.value);return s}getIdDict(e,t){var r,s=Object.create(null),i=this.proto.list.length;if(e)for(;0<i--;)1<(r=this.proto.childrenList[i]).length||!r[0]?.id||(s[r[0].id]=new S({self:this.proto.list[i],key:t}));else for(;0<i--;)1<(r=this.proto.childrenList[i]).length||!r[0]?.id||(s[r[0].id]=this.proto.list[i]);return s}getRealEmentList(){for(var e=this.proto.list.concat(),t=e.length;0<t--;)e[t]=new S({self:e[t]});return e}fix(){for(var e=0,t=this.proto.list=this.transform(this.proto.value),r=this.proto.childrenList=[],s=S.makeElementByString._clear();e<t.length;)r.push(Array.from(s.appendChild(t[e++]).children));return this.self.innerHTML="",this.self.appendChild(s),this}get childrenList(){return this.proto.childrenList}constructor(e,t,r,s,i){var o=e,o=o instanceof l?(e=o.id,o):"string"==typeof o?document.getElementById(o):(e="",!1);S.addId(e,!o),super({self:o||S.newXHTML("div",{id:e})},{id:e,initValue:r?.[Symbol.iterator]?Array.from(r):[]},s),this.proto,this.tryHTML=t,Object.assign(this.fix().self,i)}},A=class RealImgList extends k{static _react(e,t=!0,r=!0,s=!0){try{for(var i,o=this._getPositionsOfChildRN(e);o.length;){var a=o.pop().reverse(),n=e.value;if(!a.length)return this.realSet(n,t,r,s);for(i=this.proto.value;1<a.length;)i=i[a.pop()];n!==i[a[0]]&&(i[a[0]]=n),i===this.proto.value&&(this.proto.childrenList[a[0]][0].src=String(n?.src??n))}return t&&this.react?.(s),r&&this.notify(s),!0}catch(e){if(this instanceof RealImgList)throw e;this.error('Please avoid using method "react" of typeof '+this?.name+" !\n"+e.message)}}cloneImgList(){for(var e=this.childrenList.concat(),t=e.length;0<t--;)e[t]=e[t][0].cloneNode();return e}protoTransform(e){var t,r,s=[];try{var i=e[Symbol.iterator]()}catch{throw new Error('=> "value" must be Array !')}for(;!(t=i.next()).done;)s.push(t.done=document.createElement("div")),t.done.appendChild(t.value instanceof Image?t.value:((r=new Image).src=String(t.value),r));return s}protoSet(e){if(!e?.[Symbol.iterator])throw new Error('=> "value" must be Array !');for(var t=Array(2),r=c(e,"src"),s=c(this.proto.value,"src");t[0]=s.next(),t[1]=r.next(),!t[0].done^t[1].done&&!t[0].done;)if(t[0].value!==t[1].value)return this.proto.value=Array.from(e),!0;return!1}constructor(e,t,r,s){super(e,!0,t,r,s)}},P=class RealDivQueue extends k{static proto=class AntiQueue extends k.proto{queueArray};static tempTarget=void(o&&(g.onload.then(()=>S.addCSSRules(".RealDivQueue",{">div:hover":{transform:"scale(1.1,1)"},">div:active":{transform:"scale(1.2,1)"}})),addEventListener("mousedown",e=>RealDivQueue.tempTarget=e.target),addEventListener("mouseup",e=>{for(var t,r,s=[r=RealDivQueue.tempTarget];r=r.parentElement;)s.push(r);for(var i=[r=e.target];r=r.parentElement;)i.push(r);if(s.pop()===i.pop()){for(r=[];(r[0]=s.pop())===(r[1]=i.pop());)if(!s.length)return;var[e,o]=r;if(e&&o){var a=e.parentElement;if(a.classList.contains("RealDivQueue")){for(t of w.searchByObj(a))if(t instanceof RealDivQueue)break;a=t.queueArray,a=(r[0]=a.indexOf(t.proto.list.indexOf(r[0])))>(r[1]=a.indexOf(t.proto.list.indexOf(r[1])))?a.slice(0,r[1]).concat(a[r[0]],a.slice(r[1],r[0]),a.slice(r[0]+1)):a.slice(0,r[0]).concat(a.slice(r[0]+1,r[1]+1),a[r[0]],a.slice(r[1]+1)),t.applyQueue(a,e,o)}}}})));getListQueue(){this.proto;for(var e=this.queueArray,t=e.length;0<t--;)e[t]=this.proto.list[e[t]];return e}fix(){for(var e=0,t=this.proto.list=this.transform(this.proto.value),r=this.proto.childrenList=[];e<t.length;)r.push(Array.from(t[e++].children));return this.applyQueue([])}applyQueue(e,t,r){for(var s=this.queueArray??[],i=Array.isArray(e),o=(e=i?e.slice(0,this.proto.list.length):s,this.proto.list.concat()),a=o.length,n=this.self.scrollTop,l=this.self.scrollLeft,c=a;0<c--;)null==e[c]&&(e[c]=c),-1===e.indexOf(c)&&this.error('Illegal "queueArray" !');if(-1!==(c=[s.indexOf(this.proto.list.indexOf(t)),s.indexOf(this.proto.list.indexOf(r))])[0]&&-1!==c[1])c[0]<c[1]?r.insertAdjacentElement("afterend",t):r.insertAdjacentElement("beforebegin",t);else{for(var c=0,h=S.makeElementByString._clear();c<a;)h.appendChild(o[e[c++]]);this.self.classList.add("disappear"),this.self.innerHTML="",this.self.appendChild(h),this.self.scrollTo({top:n,left:l,behavior:"instant"}),this.self.classList.remove("disappear")}return this.proto.queueArray=e,i&&(this.react?.(),this.notify(!0)),this}get queueArray(){return this.proto.queueArray?.concat?.()}},j=(e,t,r)=>k.createByClassName("realDivSelect",e,t,r),g.onload=g.onload.finally(()=>k.defineDivListClass("realDivSelect",{tryRealNode:!0,cssRuleObjObj:{"":{background:"linear-gradient(135deg,#fff,#000)"},">div":{"background-color":"#333",transform:"scale(0.8,1)"},">div:hover":{transform:"scale(0.9,1)"},">.selected":{"background-color":"#555",transform:"scale(1)","font-weight":"bolder"}},callback:(()=>{let t={bubbles:!0,cancelable:!1};function tempGet(){for(var e=[],t=this.proto.list,r=0;t[r];r++)t[r].classList.contains("selected")&&e.push(this.info.optionList[r]);return this.info.multiple||e.length||!r||(t[0].classList.add("selected"),e.push(this.info.optionList[0])),e}function tempSet(e){for(var t of(this.info.optionList=[],this.proto.value=Object.keys(e=Object(e)).sort().sort((e,t)=>e-t)))this.info.optionList.push(e[t]);return this.fix().value,!1}async function tempReact(e){return e.react?.(),await e.notify(),e.self.dispatchEvent(new Event("change",t))}return addEventListener("click",e=>{var t=e.target.parentElement;if(t&&t.classList.contains("realDivSelect")){var r,s=0;for(o=w.searchByObj(t);(r=o.pop())&&!(r instanceof k););if(r){var t=r,i=t.value[0],o=t.proto.list;if(t.info.multiple)return e.target.classList.toggle("selected"),tempReact(t);for(;r=o[s++];)e.target===r?r.classList.add("selected"):r.classList.remove("selected");i!==t.value[0]&&tempReact(t)}}}),function(e,t,r){this.get=tempGet,this.set=tempSet,this.info=Object(this.info),this.info.multiple=Boolean(t),"function"==typeof r&&(this.self.onchange=r.bind(this)),this.value=e}})()})),T=e=>k.createByClassName("realDivSearch",e),g.onload=g.onload.finally(()=>k.defineDivListClass("realDivSearch",{callback:(()=>{var s;let t={bubbles:!0,cancelable:!1},r=Promise.resolve();function tempGet(){return this.info.inputer.value}function tempSet(e){return Array.isArray(e)?this.info.wordList=e:this.error('"value must be Array !'),r.then(()=>this.info.inputer.dispatchEvent(new Event("input",t))),!((s=s||this).info.matcher.value={})}return addEventListener("click",e=>R.afterNow(()=>function tempReact(e){s&&e!==s.info.inputer&&(s.info.matcher.value={},s.react?.(),s.notify(!0))}(e.target))),S.addEventListenerBySelectors(".realDivSearch>:nth-child(1)>textarea","click",async e=>(await 0,e.target.dispatchEvent(new Event("input",t)))),S.addEventListenerBySelectors(".realDivSearch>:nth-child(1)>textarea","input",e=>{for(var r,t=w.searchByObj(e.target.parentElement.parentElement);(r=t.pop())&&!(r instanceof k););if(r){let t=new RegExp(r.info.inputer.value,"i");r.info.matcher.value=R.arrayToObject(r.info.wordList.filter(e=>t.test(String(e))))}}),S.addEventListenerBySelectors(".realDivSearch>:nth-child(2)>div>div","click",e=>{for(var t,r=w.searchByObj(e.target.parentElement.parentElement.parentElement);(t=r.pop())&&!(t instanceof k););t&&(t.info.inputer.value=t.info.matcher.value[0],(s=t).react?.(),s.notify(!0))}),function(e){var t=k.createByClassName("realDivSelect");this.proto.value=['<textarea placeholder="'+String(e)+'"></textarea>',t.self],this.fix().info=Object(this.info),this.info.inputer=this.proto.childrenList[0][0],this.info.matcher=t,this.info.wordList=[],this.get=tempGet,this.set=tempSet}})(),tryHTML:!0,tryRealNode:!0,cssRuleObjObj:{">:nth-child(2)>div>div:hover":{transform:"scale(0.9,1)"}}})),D=e=>k.createByClassName("realDivSeries",e),g.onload=g.onload.finally(()=>{return k.defineDivListClass("realDivSeries",{tryRealNode:!0,cssRuleObjObj:{">div:nth-child(1)":{"font-weight":"bolder"},".hidden>div:nth-child(n + 2)":{display:"none"}},callback:(S.addEventListenerBySelectors(".realDivSeries>div:nth-child(1)","click",e=>{for(var t,r=S.searchByObj(e.target.parentElement);(t=r.pop())&&!(t instanceof k););t&&t.toggleClassName("hidden")}),function(e){this.transform=getTransform.call(this,e),this.fix()})});function getTransform(e){return("function"==typeof e?function _fn(e,t){return this.protoTransform(n.concat(e(),t))}:e instanceof R?function _realNode(e,t){return this.protoTransform(n.concat(String(e.value),t))}:function _str(e,t){return this.protoTransform(n.concat(String(e),t))}).bind(this,e)}})):u("No DOM !"),e.RealWorld=g,e.RealNode=R,e.RealGroup=b,e.RealTarget=w,e.RealStory=N,e.RealPromise=M,e.RealElement=S,e.RealCanvas=C,e.RealLoader=L,e.RealSelect=E,e.RealComtag=x,e.RealSVG=O,e.RealDivList=k,e.RealImgList=A,e.RealDivQueue=P,e.createRealDivSelect=j,e.createRealDivSearch=T,e.createRealDivSeries=D,Object.assign(globalThis,e),u("Sync\nin "+R.makeNumStr0oTail(i.now()-B)+" ms."),e})());
